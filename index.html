document.getElementById('searchBtn').onclick = async function() {
  const animeId = document.getElementById('animeId').value.trim();
  const statusElement = document.getElementById('searchStatus');

  console.log('Iniciando búsqueda con ID:', animeId);

  if (!animeId) {
    statusElement.textContent = 'Por favor, ingresa un ID válido de MyAnimeList.';
    statusElement.style.color = 'red';
    return;
  }

  statusElement.textContent = 'Buscando datos del anime...';
  statusElement.style.color = '#555';

  try {
    console.log('Solicitando a Jikan:', `https://api.jikan.moe/v4/anime/${animeId}`);
    const response = await fetch(`https://api.jikan.moe/v4/anime/${animeId}`);
    console.log('Respuesta de Jikan:', response);
    if (!response.ok) throw new Error('Anime no encontrado en la base de datos, status: ' + response.status);
    const data = await response.json();
    console.log('Datos de Jikan:', data);
    const anime = data.data;

    if (!anime) throw new Error('No se encontraron datos del anime');

    // Temporalmente omitir traducción
    const synopsisTranslated = anime.synopsis || '';

    document.getElementById('animeTitleMain').value = anime.title || '';
    document.getElementById('animeTitleAlt').value = anime.title_japanese || '';
    document.getElementById('coverUrl').value = anime.images?.jpg?.image_url || '';
    document.getElementById('studios').value = anime.studios?.map(s => s.name).join(', ') || '';
    document.getElementById('myAnimeListUrl').value = anime.url || '';
    document.getElementById('synopsis').value = synopsisTranslated || '';

    const estadoMap = {
      'Finished Airing': 'Finalizado',
      'Currently Airing': 'En emisión',
      'Not yet aired': 'En emisión'
    };
    document.getElementById('estado').value = estadoMap[anime.status] || 'En emisión';

    document.getElementById('duracion').value = anime.duration ? anime.duration.replace(' per ep', '') : '';

    const temporadaMap = {
      'winter': 'Invierno',
      'spring': 'Primavera',
      'summer': 'Verano',
      'fall': 'Otoño'
    };
    document.getElementById('temporadaEstacion').value = temporadaMap[anime.season] || 'Otoño';
    document.getElementById('temporadaAnio').value = anime.year || new Date().getFullYear();

    document.getElementById('episodios').value = anime.episodes ? `01/${anime.episodes}` : '';

    statusElement.textContent = 'Datos del anime cargados (traducción omitida temporalmente).';
    statusElement.style.color = 'green';
  } catch (error) {
    console.error('Error en la búsqueda:', error);
    statusElement.textContent = 'Error al cargar los datos: ' + error.message;
    statusElement.style.color = 'red';
  }
};
