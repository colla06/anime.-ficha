<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Ficha Anime</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #1f2937; color: #e5e7eb; }
        .section-card { background-color: #374151; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .section-header { cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .section-content { display: none; }
        .section-content.active { display: block; }
        input, select, textarea { background-color: #4b5563; color: #fff; border: 1px solid #6b7280; border-radius: 4px; padding: 0.5rem; }
        button { background-color: #2563eb; color: #fff; padding: 0.5rem 1rem; border-radius: 4px; transition: background-color 0.2s; }
        button:hover { background-color: #1d4ed8; }
        .notice { position: fixed; bottom: 1rem; right: 1rem; padding: 0.75rem; border-radius: 0.5rem; color: #fff; z-index: 1000; }
        .notice-success { background-color: #16a34a; }
        .notice-error { background-color: #dc2626; }
        .bookmark-btn { padding: 8px 15px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer; background-color: #4b5563; color: white; }
        .bookmark-btn:hover { background-color: #1a73e8; }
        .bookmark-btn.following, .bookmark-btn.checked { background-color: #2e7d32; }
        .video-player-section { background: #2d3748; padding: 15px; border-radius: 8px; }
        .video-display iframe { width: 100%; height: 400px; border-radius: 8px; }
        .preview-container { background: #2d3748; padding: 1rem; border-radius: 8px; }
        .html-output-container textarea { font-family: 'Courier New', monospace; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltip-text { visibility: hidden; width: 120px; background-color: #4b5563; color: #fff; text-align: center; border-radius: 4px; padding: 5px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s; }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-400">Generador de Ficha Anime</h1>
        
        <!-- Autenticaci√≥n -->
        <div class="section-card">
            <div class="section-header" onclick="toggleSection(this)">
                <h2 class="text-xl font-semibold text-blue-400">Autenticaci√≥n con Blogger</h2>
                <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="section-content active">
                <button id="authButton" class="mt-2">Iniciar sesi√≥n con Google</button>
                <p id="authStatus" class="mt-2 text-gray-300"></p>
                <label for="blogId" class="block text-sm mb-1 mt-4">ID del Blog</label>
                <input type="text" id="blogId" value="3321190454875664092" class="w-full" readonly>
            </div>
        </div>

        <!-- B√∫squeda -->
        <div class="section-card">
            <div class="section-header" onclick="toggleSection(this)">
                <h2 class="text-xl font-semibold text-blue-400">B√∫squeda por ID (MyAnimeList)</h2>
                <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="section-content active">
                <div class="flex gap-4">
                    <input type="text" id="searchQuery" placeholder="Introduce el ID de MyAnimeList (ej. 52215)" class="flex-1">
                    <button id="searchButton">Buscar</button>
                </div>
            </div>
        </div>

        <!-- Editar Entrada -->
        <div class="section-card">
            <div class="section-header" onclick="toggleSection(this)">
                <h2 class="text-xl font-semibold text-blue-400">Editar Entrada Existente</h2>
                <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="section-content active">
                <div class="flex gap-4">
                    <input type="text" id="postId" placeholder="Introduce el ID de la entrada de Blogger" class="flex-1">
                    <button id="loadPostButton">Cargar Entrada</button>
                </div>
            </div>
        </div>

        <!-- Formulario -->
        <form id="animeForm" class="space-y-6">
            <!-- Informaci√≥n General -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2 class="text-xl font-semibold text-blue-400">Informaci√≥n General</h2>
                    <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div class="section-content active">
                    <label for="tituloPrincipal" class="block text-sm mb-1">T√≠tulo principal</label>
                    <input type="text" id="tituloPrincipal" name="tituloPrincipal" class="w-full">
                    <label for="tituloAlternativo" class="block text-sm mb-1 mt-4">T√≠tulo alternativo</label>
                    <input type="text" id="tituloAlternativo" name="tituloAlternativo" class="w-full">
                    <label for="sinopsis" class="block text-sm mb-1 mt-4">Sinopsis</label>
                    <textarea id="sinopsis" name="sinopsis" class="w-full h-24"></textarea>
                    <label for="urlPortada" class="block text-sm mb-1 mt-4">URL de la portada</label>
                    <input type="text" id="urlPortada" name="urlPortada" class="w-full">
                    <label for="estudio" class="block text-sm mb-1 mt-4">Estudio(s)</label>
                    <input type="text" id="estudio" name="estudio" class="w-full">
                    <label for="urlMyAnimeList" class="block text-sm mb-1 mt-4">URL MyAnimeList</label>
                    <input type="text" id="urlMyAnimeList" name="urlMyAnimeList" class="w-full">
                    <label for="urlAniList" class="block text-sm mb-1 mt-4">URL AniList</label>
                    <input type="text" id="urlAniList" name="urlAniList" class="w-full">
                    <label for="trailerUrl" class="block text-sm mb-1 mt-4">URL del Trailer</label>
                    <input type="text" id="trailerUrl" name="trailerUrl" class="w-full">
                    <label for="estado" class="block text-sm mb-1 mt-4">Estado</label>
                    <div class="flex gap-4">
                        <label><input type="radio" name="estado" value="Finalizado" checked> Finalizado</label>
                        <label><input type="radio" name="estado" value="En emisi√≥n"> En emisi√≥n</label>
                        <label><input type="radio" name="estado" value="Pr√≥ximamente"> Pr√≥ximamente</label>
                    </div>
                    <label for="proxEpisodio" class="block text-sm mb-1 mt-4">Pr√≥ximo Episodio</label>
                    <input type="text" id="proxEpisodio" name="proxEpisodio" class="w-full">
                    <label for="duracion" class="block text-sm mb-1 mt-4">Duraci√≥n</label>
                    <input type="text" id="duracion" name="duracion" class="w-full">
                    <label for="temporadaEstacion" class="block text-sm mb-1 mt-4">Temporada (estaci√≥n)</label>
                    <select id="temporadaEstacion" name="temporadaEstacion" class="w-full">
                        <option value="invierno">Invierno</option>
                        <option value="primavera">Primavera</option>
                        <option value="verano">Verano</option>
                        <option value="oto√±o">Oto√±o</option>
                    </select>
                    <label for="temporadaA√±o" class="block text-sm mb-1 mt-4">Temporada (a√±o)</label>
                    <input type="text" id="temporadaA√±o" name="temporadaA√±o" class="w-full">
                    <label for="tipo" class="block text-sm mb-1 mt-4">Tipo</label>
                    <div class="flex gap-4">
                        <label><input type="radio" name="tipo" value="WEBrip"> WEBrip</label>
                        <label><input type="radio" name="tipo" value="BD"> BD</label>
                    </div>
                    <label for="episodios" class="block text-sm mb-1 mt-4">Episodios (ej. 06/25)</label>
                    <input type="text" id="episodios" name="episodios" class="w-full">
                    <label for="tags" class="block text-sm mb-1 mt-4">G√©neros (selecciona uno o m√°s)</label>
                    <select id="tags" name="tags" multiple class="w-full h-24">
                        <option value="acci√≥n">Acci√≥n</option>
                        <option value="√°ngeles">√Ångeles</option>
                        <option value="artes marciales">Artes Marciales</option>
                        <option value="aventura">Aventura</option>
                        <option value="comedia">Comedia</option>
                        <option value="demonios">Demonios</option>
                        <option value="deporte">Deporte</option>
                        <option value="drama">Drama</option>
                        <option value="ecchi">Ecchi</option>
                        <option value="escolar">Escolar</option>
                        <option value="fantas√≠a">Fantas√≠a</option>
                        <option value="ficci√≥n">Ficci√≥n</option>
                        <option value="gore">Gore</option>
                        <option value="guerra">Guerra</option>
                        <option value="harem">Harem</option>
                        <option value="hist√≥rico">Hist√≥rico</option>
                        <option value="humor negro">Humor Negro</option>
                        <option value="idols">Idols</option>
                        <option value="isekai">Isekai</option>
                        <option value="juegos">Juegos</option>
                        <option value="magia">Magia</option>
                        <option value="mecha">Mecha</option>
                        <option value="militar">Militar</option>
                        <option value="misterio">Misterio</option>
                        <option value="m√∫sica">M√∫sica</option>
                        <option value="parodia">Parodia</option>
                        <option value="peleas">Peleas</option>
                        <option value="pel√≠cula">Pel√≠cula</option>
                        <option value="poderes">Poderes</option>
                        <option value="psicol√≥gico">Psicol√≥gico</option>
                        <option value="recuentos de vida">Recuentos de Vida</option>
                        <option value="reencarnaci√≥n">Reencarnaci√≥n</option>
                        <option value="romance">Romance</option>
                        <option value="samurai">Samurai</option>
                        <option value="seinen">Seinen</option>
                        <option value="shounen">Shounen</option>
                        <option value="sobrenatural">Sobrenatural</option>
                        <option value="suspenso">Suspenso</option>
                        <option value="terror">Terror</option>
                        <option value="vampiros">Vampiros</option>
                        <option value="viaje en el tiempo">Viaje en el Tiempo</option>
                        <option value="videojuego">Videojuego</option>
                        <option value="yuri">Yuri</option>
                        <option value="zombies">Zombies</option>
                        <option value="2025 verano">2025 Verano</option>
                        <option value="2025 oto√±o">2025 Oto√±o</option>
                        <option value="2025 invierno">2025 Invierno</option>
                        <option value="2025 primavera">2025 Primavera</option>
                    </select>
                    <label for="videoIframe" class="block text-sm mb-1 mt-4">URL del Reproductor (iframe)</label>
                    <textarea id="videoIframe" name="videoIframe" class="w-full h-24"></textarea>
                    <label for="contrasena" class="block text-sm mb-1 mt-4">Contrase√±a</label>
                    <input type="text" id="contrasena" name="contrasena" class="w-full" value="animeyseriesdo">
                </div>
            </div>

            <!-- Datos 720p HDL -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2 class="text-xl font-semibold text-blue-400">Datos 720p HDL</h2>
                    <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div class="section-content">
                    <label for="fansub720" class="block text-sm mb-1">Fansub</label>
                    <input type="text" id="fansub720" name="fansub720" class="w-full">
                    <label for="subtitulos720" class="block text-sm mb-1 mt-4">Subt√≠tulos</label>
                    <div class="flex gap-4">
                        <label><input type="checkbox" name="subtitulos720" value="Espa√±ol Espa√±a"> Espa√±ol Espa√±a</label>
                        <label><input type="checkbox" name="subtitulos720" value="Espa√±ol Latino"> Espa√±ol Latino</label>
                    </div>
                    <label for="idioma720" class="block text-sm mb-1 mt-4">Idioma (Audio)</label>
                    <select id="idioma720" name="idioma720" multiple class="w-full h-24">
                        <option value="Japon√©s">Japon√©s</option>
                        <option value="Latino">Latino</option>
                        <option value="Castellano">Castellano</option>
                    </select>
                    <label for="encoder720" class="block text-sm mb-1 mt-4">Encoder</label>
                    <input type="text" id="encoder720" name="encoder720" class="w-full">
                    <label for="formato720" class="block text-sm mb-1 mt-4">Formato</label>
                    <input type="text" id="formato720" name="formato720" value="MP4 (x264)" readonly class="w-full">
                    <label for="resolucion720" class="block text-sm mb-1 mt-4">Resoluci√≥n</label>
                    <input type="text" id="resolucion720" name="resolucion720" value="1280x720" readonly class="w-full">
                    <label for="comprimido720" class="block text-sm mb-1 mt-4">Comprimido</label>
                    <div class="flex gap-4">
                        <label><input type="radio" name="comprimido720" value="S√≠"> S√≠</label>
                        <label><input type="radio" name="comprimido720" value="No" checked> No</label>
                    </div>
                    <label for="calidad720" class="block text-sm mb-1 mt-4">Calidad</label>
                    <input type="text" id="calidad720" name="calidad720" value="Muy buena" readonly class="w-full">
                    <label for="tama√±o720" class="block text-sm mb-1 mt-4">Tama√±o por archivo</label>
                    <input type="text" id="tama√±o720" name="tama√±o720" class="w-full">
                    <label for="servidores720" class="block text-sm mb-1 mt-4">Servidores</label>
                    <select id="servidores720" name="servidores720" multiple class="w-full h-24">
                        <option value="Mega">Mega</option>
                        <option value="MediaFire">MediaFire</option>
                        <option value="Google Drive">Google Drive</option>
                        <option value="TeraBox">TeraBox</option>
                        <option value="Index">Index</option>
                    </select>
                    <label for="uploader720" class="block text-sm mb-1 mt-4">Uploader</label>
                    <input type="text" id="uploader720" name="uploader720" class="w-full">
                    <label for="enlaces720" class="block text-sm mb-1 mt-4">Enlaces 720p (Pastebin o Index)</label>
                    <input type="text" id="enlaces720" name="enlaces720" class="w-full">
                </div>
            </div>

            <!-- Datos 1080p FHD -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2 class="text-xl font-semibold text-blue-400">Datos 1080p FHD</h2>
                    <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div class="section-content">
                    <label for="fansub1080" class="block text-sm mb-1">Fansub</label>
                    <input type="text" id="fansub1080" name="fansub1080" class="w-full">
                    <label for="subtitulos1080" class="block text-sm mb-1 mt-4">Subt√≠tulos</label>
                    <div class="flex gap-4">
                        <label><input type="checkbox" name="subtitulos1080" value="Espa√±ol Espa√±a"> Espa√±ol Espa√±a</label>
                        <label><input type="checkbox" name="subtitulos1080" value="Espa√±ol Latino"> Espa√±ol Latino</label>
                    </div>
                    <label for="idioma1080" class="block text-sm mb-1 mt-4">Idioma (Audio)</label>
                    <select id="idioma1080" name="idioma1080" multiple class="w-full h-24">
                        <option value="Japon√©s">Japon√©s</option>
                        <option value="Latino">Latino</option>
                        <option value="Castellano">Castellano</option>
                    </select>
                    <label for="ripper1080" class="block text-sm mb-1 mt-4">Ripper</label>
                    <input type="text" id="ripper1080" name="ripper1080" class="w-full">
                    <label for="rawEncode1080" class="block text-sm mb-1 mt-4">Raw/Encode</label>
                    <input type="text" id="rawEncode1080" name="rawEncode1080" class="w-full">
                    <label for="muxeo1080" class="block text-sm mb-1 mt-4">Muxeo</label>
                    <input type="text" id="muxeo1080" name="muxeo1080" class="w-full">
                    <label for="formato1080" class="block text-sm mb-1 mt-4">Formato</label>
                    <select id="formato1080" name="formato1080" class="w-full">
                        <option value="MKV (x265)">MKV (x265)</option>
                        <option value="MP4 (x264)">MP4 (x264)</option>
                        <option value="MKV (x264)">MKV (x264)</option>
                    </select>
                    <label for="resolucion1080" class="block text-sm mb-1 mt-4">Resoluci√≥n</label>
                    <input type="text" id="resolucion1080" name="resolucion1080" value="1920x1080" readonly class="w-full">
                    <label for="comprimido1080" class="block text-sm mb-1 mt-4">Comprimido</label>
                    <div class="flex gap-4">
                        <label><input type="radio" name="comprimido1080" value="S√≠"> S√≠</label>
                        <label><input type="radio" name="comprimido1080" value="No" checked> No</label>
                    </div>
                    <label for="calidad1080" class="block text-sm mb-1 mt-4">Calidad</label>
                    <input type="text" id="calidad1080" name="calidad1080" value="Excelente" readonly class="w-full">
                    <label for="tama√±o1080" class="block text-sm mb-1 mt-4">Tama√±o por archivo</label>
                    <input type="text" id="tama√±o1080" name="tama√±o1080" class="w-full">
                    <label for="servidores1080" class="block text-sm mb-1 mt-4">Servidores</label>
                    <select id="servidores1080" name="servidores1080" multiple class="w-full h-24">
                        <option value="Index">Index</option>
                        <option value="Mega">Mega</option>
                        <option value="Google Drive">Google Drive</option>
                        <option value="TeraBox">TeraBox</option>
                        <option value="MediaFire">MediaFire</option>
                    </select>
                    <label for="uploader1080" class="block text-sm mb-1 mt-4">Uploader</label>
                    <input type="text" id="uploader1080" name="uploader1080" class="w-full">
                    <label for="enlaces1080" class="block text-sm mb-1 mt-4">Enlaces 1080p (Pastebin o Index)</label>
                    <input type="text" id="enlaces1080" name="enlaces1080" class="w-full">
                </div>
            </div>

            <!-- Acciones -->
            <div class="flex gap-4 flex-wrap">
                <button type="button" onclick="generateHTML()" class="tooltip">
                    Generar HTML
                    <span class="tooltip-text">Genera el c√≥digo HTML para Blogger</span>
                </button>
                <button type="button" id="publishButton" disabled class="tooltip">
                    Publicar en Blogger
                    <span class="tooltip-text">Publica directamente en Blogger</span>
                </button>
                <select id="publishStatus" class="p-2 rounded">
                    <option value="PUBLISHED">Publicado</option>
                    <option value="DRAFT">Borrador</option>
                </select>
            </div>
        </form>

        <!-- Vista Previa -->
        <div class="section-card mt-6">
            <div class="section-header" onclick="toggleSection(this)">
                <h2 class="text-xl font-semibold text-blue-400">Vista Previa</h2>
                <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="section-content active preview-container">
                <div id="preview"></div>
            </div>
        </div>

        <!-- HTML Generado -->
        <div class="section-card mt-6">
            <div class="section-header" onclick="toggleSection(this)">
                <h2 class="text-xl font-semibold text-blue-400">HTML Generado</h2>
                <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="section-content active html-output-container">
                <textarea id="htmlOutput" readonly class="w-full h-40"></textarea>
                <button onclick="copyHTML()" class="mt-2">Copiar HTML</button>
            </div>
        </div>

        <!-- Probar Botones de Preferencias -->
        <div class="section-card mt-6">
            <div class="section-header" onclick="toggleSection(this)">
                <h2 class="text-xl font-semibold text-blue-400">Probar Botones de Preferencias</h2>
                <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="section-content">
                <div class="bookmark-buttons">
                    <button class="bookmark-btn" id="btn-follow">üëÅÔ∏è Seguir</button>
                    <button class="bookmark-btn" id="btn-favorite">‚≠ê Favorito</button>
                    <button class="bookmark-btn" id="btn-plan">üìù En Plan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CLIENT_ID = '879567119064-pglj8dsqnka2sfpgh6hu50b723f1viia.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/blogger';
        let tokenClient;

        function toggleSection(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('svg');
            content.classList.toggle('active');
            arrow.classList.toggle('rotate-180');
        }

        // Inicializar secciones colapsadas por defecto
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Documento cargado, inicializando autenticaci√≥n...');
            if (typeof gapi === 'undefined') {
                console.error('Error: gapi no est√° definido. Verifica la carga de https://apis.google.com/js/api.js');
                showNotice('Error al cargar la biblioteca de Google API.', 'error');
                return;
            }
            if (typeof google === 'undefined' || !google.accounts) {
                console.error('Error: google.accounts no est√° definido. Verifica la carga de https://accounts.google.com/gsi/client');
                showNotice('Error al cargar la biblioteca de Google Sign-In.', 'error');
                return;
            }

            // Inicializar secciones: solo "Informaci√≥n General" y "Vista Previa" abiertas por defecto
            document.querySelectorAll('.section-content').forEach(content => {
                if (!content.parentElement.querySelector('h2').textContent.includes('Informaci√≥n General') &&
                    !content.parentElement.querySelector('h2').textContent.includes('Vista Previa')) {
                    content.classList.remove('active');
                }
            });

            gapi.load('client', () => {
                console.log('gapi.client cargado, inicializando cliente...');
                initializeGapiClient();
            });

            document.getElementById('authButton').addEventListener('click', () => {
                console.log('Bot√≥n de autenticaci√≥n clicado');
                handleAuthClick();
            });
            document.getElementById('searchButton').addEventListener('click', searchAnime);
            document.getElementById('loadPostButton').addEventListener('click', loadPost);
            document.getElementById('publishButton').addEventListener('click', publishPost);

            // Inicializar botones de preferencias para pruebas
            const btnFollow = document.getElementById('btn-follow');
            const btnFavorite = document.getElementById('btn-favorite');
            const btnPlan = document.getElementById('btn-plan');
            const keys = {
                follow: 'followedPosts',
                favorite: 'favoritePosts',
                plan: 'onPlanPosts',
            };
            function getList(key) {
                try {
                    return JSON.parse(localStorage.getItem(key) || '[]');
                } catch {
                    return [];
                }
            }
            function saveList(key, list) {
                localStorage.setItem(key, JSON.stringify(list));
            }
            function isInList(key) {
                const list = getList(key);
                return list.some(p => p.id === 'test-post');
            }
            function toggleItem(key, button, activeClass) {
                let list = getList(key);
                const index = list.findIndex(p => p.id === 'test-post');
                if (index > -1) {
                    list.splice(index, 1);
                    button.classList.remove(activeClass);
                } else {
                    list.push({ id: 'test-post', title: 'Prueba', url: '#', thumbnail: '' });
                    button.classList.add(activeClass);
                }
                saveList(key, list);
            }
            if (isInList(keys.follow)) btnFollow.classList.add('following');
            if (isInList(keys.favorite)) btnFavorite.classList.add('checked');
            if (isInList(keys.plan)) btnPlan.classList.add('checked');
            btnFollow.addEventListener('click', () => {
                toggleItem(keys.follow, btnFollow, 'following');
                btnFollow.textContent = btnFollow.classList.contains('following') ? '‚ùå Dejar de seguir littoral
                seguir' : 'üëÅÔ∏è Seguir';
            });
            btnFavorite.addEventListener('click', () => {
                toggleItem(keys.favorite, btnFavorite, 'checked');
            });
            btnPlan.addEventListener('click', () => {
                toggleItem(keys.plan, btnPlan, 'checked');
            });
            btnFollow.textContent = btnFollow.classList.contains('following') ? '‚ùå Dejar de seguir' : 'üëÅÔ∏è Seguir';
        });

        async function initializeGapiClient() {
            try {
                console.log('Inicializando gapi.client...');
                await gapi.client.init({
                    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/blogger/v3/rest'],
                });
                console.log('gapi.client inicializado con √©xito');
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: (tokenResponse) => {
                        console.log('Respuesta de autenticaci√≥n:', tokenResponse);
                        if (tokenResponse.access_token) {
                            document.getElementById('authStatus').textContent = 'Autenticado con √©xito';
                            document.getElementById('publishButton').disabled = false;
                            showNotice('Autenticaci√≥n exitosa.', 'success');
                        } else {
                            console.error('Error en la autenticaci√≥n:', tokenResponse);
                            showNotice('Error en la autenticaci√≥n.', 'error');
                        }
                    },
                });
            } catch (error) {
                console.error('Error al inicializar gapi.client:', error);
                showNotice('Error al inicializar el cliente de Google: ' + error.message, 'error');
            }
        }

        function handleAuthClick() {
            if (!tokenClient) {
                console.error('tokenClient no est√° inicializado');
                showNotice('Error: Cliente de autenticaci√≥n no inicializado.', 'error');
                return;
            }
            console.log('Solicitando token de acceso...');
            tokenClient.requestAccessToken();
        }

        function showNotice(message, type) {
            const notice = document.createElement('div');
            notice.className = `notice notice-${type}`;
            notice.textContent = message;
            document.body.appendChild(notice);
            setTimeout(() => notice.remove(), 3000);
        }

        async function searchAnime() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query || isNaN(query)) {
                showNotice('Introduce un ID num√©rico v√°lido de MyAnimeList.', 'error');
                return;
            }

            try {
                const response = await fetch(`https://api.jikan.moe/v4/anime/${query}/full`);
                if (response.status === 429) {
                    showNotice('L√≠mite de solicitudes alcanzado. Espera un momento.', 'error');
                    return;
                }
                if (!response.ok) {
                    showNotice('No se encontr√≥ un anime con ese ID.', 'error');
                    return;
                }
                const { data: anime } = await response.json();
                selectAnime(anime);
            } catch (error) {
                console.error('Error fetching anime:', error);
                showNotice('Error al buscar en MyAnimeList: ' + error.message, 'error');
            }
        }

        async function selectAnime(anime) {
            try {
                document.getElementById('tituloPrincipal').value = anime.title || '';
                document.getElementById('tituloAlternativo').value = anime.title_english || anime.title_japanese || (anime.titles?.find(t => t.type === 'Synonym')?.title) || '';
                document.getElementById('estudio').value = anime.studios?.map(s => s.name).join(', ') || 'Desconocido';
                document.getElementById('urlPortada').value = anime.images?.jpg?.large_image_url || '';
                document.getElementById('urlMyAnimeList').value = anime.url || '';
                document.getElementById('urlAniList').value = anime.url ? `https://anilist.co/anime/${document.getElementById('searchQuery').value}` : '';
                document.getElementById('duracion').value = anime.duration || '';
                document.getElementById('temporadaEstacion').value = anime.season ? anime.season.toLowerCase() : '';
                document.getElementById('temporadaA√±o').value = anime.year || '';
                document.getElementById('episodios').value = anime.episodes ? `${anime.episodes}/${anime.episodes}` : '';
                document.getElementById('estado').value = anime.status === 'Currently Airing' ? 'En emisi√≥n' : anime.status === 'Not yet aired' ? 'Pr√≥ximamente' : 'Finalizado';
                document.getElementById('trailerUrl').value = anime.trailer?.youtube_id ? `https://www.youtube.com/watch?v=${anime.trailer.youtube_id}` : '';
                const tags = anime.genres?.map(g => g.name.toLowerCase()) || [];
                if (anime.season && anime.year) {
                    const seasonTag = `${anime.year} ${anime.season.toLowerCase()}`;
                    if (['2025 verano', '2025 oto√±o', '2025 invierno', '2025 primavera'].includes(seasonTag)) {
                        tags.push(seasonTag);
                    }
                }
                const selectTags = document.getElementById('tags');
                Array.from(selectTags.options).forEach(option => {
                    option.selected = tags.includes(option.value);
                });

                let synopsis = anime.synopsis || 'Sin sinopsis disponible.';
                try {
                    const response = await fetch('https://graphql.anilist.co', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            query: `
                                query ($idMal: Int) {
                                    Media(idMal: $idMal, type: ANIME) {
                                        description(asHtml: false)
                                    }
                                }
                            `,
                            variables: { idMal: parseInt(document.getElementById('searchQuery').value) }
                        })
                    });
                    const { data } = await response.json();
                    synopsis = data?.Media?.description?.replace(/<[^>]+>/g, '') || `Por favor, traduce manualmente: "${synopsis}"`;
                } catch (error) {
                    console.error('Error fetching AniList synopsis:', error);
                    synopsis = `Por favor, traduce manualmente: "${synopsis}"`;
                }
                document.getElementById('sinopsis').value = synopsis;

                showNotice('Datos del anime cargados correctamente.', 'success');
            } catch (error) {
                console.error('Error selecting anime:', error);
                showNotice('Error al cargar los datos: ' + error.message, 'error');
            }
        }

        async function loadPost() {
            const blogId = document.getElementById('blogId').value.trim();
            const postId = document.getElementById('postId').value.trim();
            if (!blogId || !postId) {
                showNotice('Introduce el ID del blog y de la entrada.', 'error');
                return;
            }

            try {
                console.log(`Intentando cargar entrada: Blog ID=${blogId}, Post ID=${postId}`);
                const response = await gapi.client.blogger.posts.get({
                    blogId: blogId,
                    postId: postId
                });
                console.log('Respuesta de la API:', response);
                const post = response.result;
                console.log('Contenido de la entrada:', post.content);
                parsePostContent(post);
                showNotice('Entrada cargada correctamente.', 'success');
            } catch (error) {
                console.error('Error al cargar la entrada:', error);
                showNotice(`Error al cargar la entrada: ${error.result?.error?.message || error.message}`, 'error');
            }
        }

        function parsePostContent(post) {
            console.log('Parseando contenido de la entrada:', post.content);
            const parser = new DOMParser();
            const doc = parser.parseFromString(post.content, 'text/html');

            document.getElementById('tituloPrincipal').value = doc.querySelector('.titles--main')?.textContent || post.title || '';
            document.getElementById('tituloAlternativo').value = doc.querySelector('.titles--alt')?.textContent || '';
            document.getElementById('urlPortada').value = doc.querySelector('.anime-info__cover img')?.src || '';
            document.getElementById('estudio').value = doc.querySelector('.misc__studios span')?.textContent || '';
            document.getElementById('urlMyAnimeList').value = doc.querySelector('.misc__links a[href*="myanimelist.net"]')?.href || '';
            document.getElementById('urlAniList').value = doc.querySelector('.misc__links a[href*="anilist.co"]')?.href || '';
            document.getElementById('sinopsis').value = doc.querySelector('.synopsis__content')?.textContent.replace('<!--more-->', '') || '';
            document.getElementById('estado').value = doc.querySelector('.airing-status')?.textContent.replace('ESTADO:', '').trim() || 'Finalizado';
            document.getElementById('proxEpisodio').value = doc.querySelector('.airing-status span:nth-child(2)')?.textContent.replace('PR√ìX. EPISODIO:', '').trim() || '';
            document.getElementById('duracion').value = doc.querySelector('#duration')?.textContent.replace('Duraci√≥n:', '').trim() || '';
            const seasonLink = doc.querySelector('.season a')?.href.match(/\/search\/label\/(\d+)%20(\w+)/);
            if (seasonLink) {
                document.getElementById('temporadaA√±o').value = seasonLink[1];
                document.getElementById('temporadaEstacion').value = seasonLink[2].toLowerCase();
            }
            document.getElementById('tipo').value = doc.querySelector('#format')?.textContent.replace('Tipo:', '').trim() || 'WEBrip';
            document.getElementById('episodios').value = doc.querySelector('.content__details span b')?.textContent || '';
            document.getElementById('trailerUrl').value = doc.querySelector('.anime-related a[href*="youtube.com"]')?.href || '';
            document.getElementById('videoIframe').value = doc.querySelector('.video-display iframe')?.src || '';
            document.getElementById('contrasena').value = doc.querySelector('#enlace')?.textContent || 'animeyseriesdo';

            const tags = Array.from(doc.querySelectorAll('.anime-tags span a')).map(a => {
                const tagText = a.textContent.toLowerCase();
                return tagText.replace(/2025 (\w+)/, (match, season) => `2025 ${season.toLowerCase()}`);
            });
            const selectTags = document.getElementById('tags');
            Array.from(selectTags.options).forEach(option => {
                option.selected = tags.includes(option.value);
            });

            const table720 = doc.querySelector('.tab__panel#panel--1 .tab-custom-table');
            if (table720) {
                document.getElementById('fansub720').value = table720.querySelector('tr:nth-child(1) td')?.textContent || '';
                const subtitulos720 = table720.querySelector('tr:nth-child(2) td')?.textContent.split(', ') || [];
                document.getElementsByName('subtitulos720').forEach(cb => {
                    cb.checked = subtitulos720.includes(cb.value);
                });
                const idioma720 = table720.querySelector('tr:nth-child(3) td')?.textContent.split(', ') || [];
                const selectIdioma720 = document.getElementById('idioma720');
                Array.from(selectIdioma720.options).forEach(option => {
                    option.selected = idioma720.includes(option.value);
                });
                document.getElementById('encoder720').value = table720.querySelector('tr:nth-child(4) td')?.textContent || '';
                document.getElementById('tama√±o720').value = table720.querySelector('tr:nth-child(9) td')?.textContent || '';
                const servidores720 = table720.querySelector('tr:nth-child(10) td')?.textContent.split(', ') || [];
                const selectServidores720 = document.getElementById('servidores720');
                Array.from(selectServidores720.options).forEach(option => {
                    option.selected = servidores720.includes(option.value);
                });
                document.getElementById('uploader720').value = table720.querySelector('tr:nth-child(11) td')?.textContent || '';
                document.getElementById('enlaces720').value = table720.querySelector('.custom-detail__panel a[href*="pastebin.com"]')?.href || '';
            }

            const table1080 = doc.querySelector('.tab__panel#panel--2 .tab-custom-table');
            if (table1080) {
                document.getElementById('fansub1080').value = table1080.querySelector('tr:nth-child(1) td')?.textContent || '';
                const subtitulos1080 = table1080.querySelector('tr:nth-child(2) td')?.textContent.split(', ') || [];
                document.getElementsByName('subtitulos1080').forEach(cb => {
                    cb.checked = subtitulos1080.includes(cb.value);
                });
                const idioma1080 = table1080.querySelector('tr:nth-child(3) td')?.textContent.split(', ') || [];
                const selectIdioma1080 = document.getElementById('idioma1080');
                Array.from(selectIdioma1080.options).forEach(option => {
                    option.selected = idioma1080.includes(option.value);
                });
                document.getElementById('ripper1080').value = table1080.querySelector('tr:nth-child(4) td')?.textContent || '';
                document.getElementById('rawEncode1080').value = table1080.querySelector('tr:nth-child(5) td')?.textContent || '';
                document.getElementById('muxeo1080').value = table1080.querySelector('tr:nth-child(6) td')?.textContent || '';
                document.getElementById('formato1080').value = table1080.querySelector('tr:nth-child(7) td')?.textContent || 'MKV (x265)';
                document.getElementById('tama√±o1080').value = table1080.querySelector('tr:nth-child(11) td')?.textContent || '';
                const servidores1080 = table1080.querySelector('tr:nth-child(12) td')?.textContent.split(', ') || [];
                const selectServidores1080 = document.getElementById('servidores1080');
                Array.from(selectServidores1080.options).forEach(option => {
                    option.selected = servidores1080.includes(option.value);
                });
                document.getElementById('uploader1080').value = table1080.querySelector('tr:nth-child(13) td')?.textContent || '';
                document.getElementById('enlaces1080').value = table1080.querySelector('.custom-detail__panel a[href*="pastebin.com"]')?.href || '';
            }
        }

        async function publishPost() {
            const blogId = document.getElementById('blogId').value.trim();
            const postId = document.getElementById('postId').value.trim();
            const publishStatus = document.getElementById('publishStatus').value;
            if (!blogId) {
                showNotice('Introduce el ID del blog.', 'error');
                return;
            }

            const htmlContent = document.getElementById('htmlOutput').value;
            if (!htmlContent) {
                showNotice('Genera el HTML primero.', 'error');
                return;
            }

            const postData = {
                title: document.getElementById('tituloPrincipal').value,
                content: htmlContent,
                labels: Array.from(document.getElementById('tags').selectedOptions).map(option => {
                    if (['2025 verano', '2025 oto√±o', '2025 invierno', '2025 primavera'].includes(option.value)) {
                        return option.value.replace(/(\d{4}) (\w+)/, (match, year, season) => 
                            `${year} ${season.charAt(0).toUpperCase() + season.slice(1)}`
                        );
                    }
                    return option.value;
                }),
                status: publishStatus
            };

            try {
                let response;
                if (postId) {
                    response = await gapi.client.blogger.posts.patch({
                        blogId: blogId,
                        postId: postId,
                        resource: postData
                    });
                } else {
                    response = await gapi.client.blogger.posts.insert({
                        blogId: blogId,
                        resource: postData
                    });
                }
                showNotice(`Entrada ${postId ? 'actualizada' : 'publicada'} con √©xito: ${response.result.url}`, 'success');
                document.getElementById('postId').value = response.result.id;
            } catch (error) {
                console.error('Error publishing post:', error);
                showNotice(`Error al publicar la entrada: ${error.result?.error?.message || error.message}`, 'error');
            }
        }

        function generateHTML() {
            const form = document.getElementById('animeForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);

            data.subtitulos720 = formData.getAll('subtitulos720').join(', ');
            data.idioma720 = formData.getAll('idioma720').join(', ');
            data.servidores720 = formData.getAll('servidores720').join(', ');
            data.subtitulos1080 = formData.getAll('subtitulos1080').join(', ');
            data.idioma1080 = formData.getAll('idioma1080').join(', ');
            data.servidores1080 = formData.getAll('servidores1080').join(', ');
            data.tags = formData.getAll('tags');

            const seasonTags = ['2025 verano', '2025 oto√±o', '2025 invierno', '2025 primavera'];
            const tagsHTML = data.tags.map(tag => {
                if (seasonTags.includes(tag)) {
                    const displayTag = tag.replace(/(\d{4}) (\w+)/, (match, year, season) => 
                        `${year} ${season.charAt(0).toUpperCase() + season.slice(1)}`
                    );
                    const urlTag = encodeURIComponent(displayTag);
                    return `<span><a href="/search/label/${urlTag}">${displayTag}</a></span>`;
                }
                return `<span><a href="/search/label/${tag}">${tag}</a></span>`;
            }).join('\n');

            const htmlContent = `
<main class="anime-main">
    <section>
        <div class="notes">
            <p>[Descarga] ${data.tituloPrincipal}: HDL MP4 - FHD MKV</p>
        </div>
    </section>
    <section class="anime-info">
        <div class="anime-info__cover">
            <img src="${data.urlPortada}" alt="cover">
        </div>
        <div class="anime-info__content">
            <div class="content__titles">
                <p class="titles--main">${data.tituloPrincipal}</p>
                ${data.tituloAlternativo ? `<p class="titles--alt">${data.tituloAlternativo}</p>` : ''}
            </div>
            <div class="content__misc">
                <div class="misc__studios">
                    <span>${data.estudio}</span>
                </div>
                <div class="misc__links">
                    ${data.urlMyAnimeList ? `<a href="${data.urlMyAnimeList}" target="_blank">MyAList</a>` : ''}
                    ${data.urlAniList ? `<a href="${data.urlAniList}" target="_blank">AList</a>` : ''}
                </div>
            </div>
            <div class="content__synopsis">
                <h2 class="synopsis__title">SINOPSIS</h2>
                <p class="synopsis__content">${data.sinopsis}<!--more--></p>
            </div>
        </div>
    </section>
    <div class="content__details">
        <div class="airing-status">
            <span><b>ESTADO:</b></span> ${data.estado}
            <br>
            ${data.proxEpisodio ? `<span>PR√ìX. EPISODIO:</span> ${data.proxEpisodio}` : ''}
        </div>
        <span id="duration">
            <svg class="i i-clock" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 7v5l3 3"></path>
            </svg>
            Duraci√≥n:<br>${data.duracion}
        </span>
        <span class="season">
            <svg class="i i-calendar" viewBox="0 0 24 24">
                <rect width="18" height="17" x="3" y="5" rx="2"></rect>
                <path d="M7 2v3m10-3v3M3 10h18"></path>
            </svg>
            Temporada:<br><a href="/search/label/${data.temporadaA√±o}%20${data.temporadaEstacion.charAt(0).toUpperCase() + data.temporadaEstacion.slice(1)}">${data.temporadaEstacion.charAt(0).toUpperCase() + data.temporadaEstacion.slice(1)} ${data.temporadaA√±o}</a>
        </span>
        <span id="format">
            <svg class="i i-tv-retro" viewBox="0 0 24 24">
                <rect width="20" height="15" x="2" y="7" rx="3"></rect>
                <path d="m7 2 5 5 5-5"></path>
            </svg>
            Tipo:<br>${data.tipo}
        </span>
        <span>
            <svg class="i i-list" viewBox="0 0 24 24">
                <path d="M7 6h14M7 12h14M7 18h14M3 6h0m0 6h0m0 18h0"></path>
            </svg>
            Episodios:<br><b>${data.episodios}</b>
        </span>
    </div>
    <section class="anime-related">
        ${data.trailerUrl ? `<a href="${data.trailerUrl}" rel="nofollow" target="_blank"><i aria-hidden="true" class="fa fa-youtube-play"></i> <b>TRAILER</b> <i aria-hidden="true" class="fa fa-external-link"></i></a>` : ''}
        <a href="#" target="_blank"><span><b>Precuela:</b></span> No Disponible</a>
    </section>
    <div class="bookmark-actions-container" id="bookmark-container">
        <span class="bookmark-actions-title"><b>Marcar esta entrada:</b></span>
        <div class="bookmark-buttons">
            <button class="bookmark-btn" id="btn-follow">üëÅÔ∏è Seguir</button>
            <button class="bookmark-btn" id="btn-favorite">‚≠ê Favorito</button>
            <button class="bookmark-btn" id="btn-plan">üìù En Plan</button>
        </div>
    </div>
    <hr class="break-line">
    ${data.videoIframe ? `
    <div class="main-player-container">
        <div class="video-player-section">
            <div class="video-player-header">
                <div class="controls-group">
                    <div class="control-item audio-control">
                        <label for="audio-option-select"><i class="fa fa-file-audio-o" aria-hidden="true"></i></label>
                        <select id="audio-option-select" onchange="changeAudioOption()">
                            <option value="japones">Japon√©s</option>
                            <option value="espanol">Espa√±ol</option>
                            <option value="dual">Dual (LA/JA)</option>
                            <option value="castellano">Castellano</option>
                            <option value="trial">Trial</option>
                        </select>
                    </div>
                    <div class="control-item video-option-control">
                        <label for="episode-option-select"><i class="fa fa-server" aria-hidden="true"></i></label>
                        <select id="episode-option-select" onchange="changeEpisodeOption()"></select>
                    </div>
                </div>
            </div>
            <div class="video-display">
                <iframe id="video-iframe" src="${data.videoIframe}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="video-title-group">
                <h3 id="video-title">Episodio 1</h3>
                <div class="nav-buttons">
                    <button id="prev-episode-btn" class="nav-button"><span class="arrow"><</span> <span class="text">Anterior</span></button>
                    <button id="next-episode-btn" class="nav-button"><span class="text">Siguiente</span> <span class="arrow">></span></button>
                </div>
            </div>
            <div class="episodes-section">
                <div class="episodes-header">
                    <div class="episodes-title-group">
                        <h3 class="episodes-title"><i class="fa fa-list" aria-hidden="true"></i> Listado</h3>
                    </div>
                    <div class="pagination-controls">
                        <select id="episode-range-select" onchange="changeEpisodeRange()"></select>
                        <input type="number" id="episode-search-input" placeholder="Buscar #" min="1">
                        <button id="search-episode-btn"><i class="fa fa-search" aria-hidden="true"></i></button>
                    </div>
                </div>
                <div id="episodes-list" class="episodes-grid"></div>
            </div>
        </div>
    </div>
    ` : ''}
    <section class="tabs-custom">
        <div class="tab__btns">
            <button class="tab__btn" panel-target="panel--1">720p HDL</button>
            <button class="tab__btn" panel-target="panel--2">1080p FHD</button>
        </div>
        <div class="tab__panels">
            <div class="tab__panel" id="panel--1">
                <table class="tab-custom-table">
                    <tr><th>Fansub:</th><td>${data.fansub720}</td></tr>
                    <tr><th>Subt√≠tulos:</th><td>${data.subtitulos720}</td></tr>
                    <tr><th>Idioma (Audio):</th><td>${data.idioma720}</td></tr>
                    <tr><th>Encoder:</th><td>${data.encoder720}</td></tr>
                    <tr><th>Formato:</th><td>${data.formato720}</td></tr>
                    <tr><th>Resoluci√≥n:</th><td>${data.resolucion720}</td></tr>
                    <tr><th>Comprimido:</th><td>${data.comprimido720}</td></tr>
                    <tr><th>Calidad:</th><td>${data.calidad720}</td></tr>
                    <tr><th>Tama√±o por archivo:</th><td>${data.tama√±o720}</td></tr>
                    <tr><th>Servidores:</th><td>${data.servidores720}</td></tr>
                    <tr><th>Uploader:</th><td>${data.uploader720}</td></tr>
                </table>
                <div class="custom-detail">
                    <button class="custom-detail__btn" panel-target="detail-panel--1">
                        <span class="btn__text">Mostrar enlaces: HDL</span>
                        <svg class="i i-chevron-down" viewBox="0 0 24 24">
                            <path d="m4 8 8 8 8-8"></path>
                        </svg>
                    </button>
                    <div class="custom-detail__panel" id="detail-panel--1">
                        ${data.enlaces720 ? `<a href="${data.enlaces720}" rel="nofollow" target="_blank">
                            <svg class="i i-download" viewBox="0 0 24 24">
                                <path d="m7 10 5 5 5-5m-5 5V3m10 12v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4"></path>
                            </svg>
                            Paste
                        </a>` : ''}
                    </div>
                </div>
            </div>
            <div class="tab__panel" id="panel--2">
                <table class="tab-custom-table">
                    <tr><th>Fansub:</th><td>${data.fansub1080}</td></tr>
                    <tr><th>Subt√≠tulos:</th><td>${data.subtitulos1080}</td></tr>
                    <tr><th>Idioma:</th><td>${data.idioma1080}</td></tr>
                    <tr><th>Ripper:</th><td>${data.ripper1080}</td></tr>
                    <tr><th>Raw/Encode:</th><td>${data.rawEncode1080}</td></tr>
                    <tr><th>Muxeo:</th><td>${data.muxeo1080}</td></tr>
                    <tr><th>Formato:</th><td>${data.formato1080}</td></tr>
                    <tr><th>Resoluci√≥n:</th><td>${data.resolucion1080}</td></tr>
                    <tr><th>Comprimido:</th><td>${data.comprimido1080}</td></tr>
                    <tr><th>Calidad:</th><td>${data.calidad1080}</td></tr>
                    <tr><th>Tama√±o por archivo:</th><td>${data.tama√±o1080}</td></tr>
                    <tr><th>Servidores:</th><td>${data.servidores1080}</td></tr>
                    <tr><th>Uploader:</th><td>${data.uploader1080}</td></tr>
                </table>
                <div class="custom-detail">
                    <button class="custom-detail__btn" panel-target="detail-panel--2">
                        <span class="btn__text">Mostrar enlaces: FHD</span>
                        <svg class="i i-chevron-down" viewBox="0 0 24 24">
                            <path d="m4 8 8 8 8-8"></path>
                        </svg>
                    </button>
                    <div class="custom-detail__panel" id="detail-panel--2">
                        ${data.enlaces1080 ? `<a href="${data.enlaces1080}" rel="nofollow" target="_blank">
                            <svg class="i i-download" viewBox="0 0 24 24">
                                <path d="m7 10 5 5 5-5m-5 5V3m10 12v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4"></path>
                            </svg>
                            Paste
                        </a>` : ''}
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div style="text-align: center;"><b><u>Contrase√±a:</u></b> 
        <span id="enlace">${data.contrasena}</span>
        <button id="copiador"> Copiar <i aria-hidden="true" class="fa fa-files-o"></i></button>
    </div>
    <div class="nextEpi"><span><i aria-hidden="true" class="fa fa-info-circle"></i> <b> Para reportar problemas con la descarga usa los comentarios. </b></span></div>
    <div style="text-align: center;"><b>¬°NO OLVIDES DEJAR UN COMENTARIO!</b></div>
    <section class="anime-tags">${tagsHTML}</section>
</main>
<style>
.anime-main { max-width: 800px; margin: 0 auto; padding: 20px; }
.anime-info { display: flex; gap: 20px; margin-bottom: 20px; }
.anime-info__cover img { max-width: 200px; border-radius: 8px; }
.anime-info__content { flex: 1; }
.content__titles { margin-bottom: 10px; }
.titles--main { font-size: 1.5em; font-weight: bold; }
.titles--alt { font-size: 1.2em; color: #777; }
.content__misc { display: flex; justify-content: space-between; margin-bottom: 10px; }
.misc__studios, .misc__links { font-size: 0.9em; }
.content__synopsis h2 { font-size: 1.2em; margin-bottom: 10px; }
.content__details { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
.content__details span { flex: 1 1 100px; font-size: 0.9em; }
.airing-status { flex: 1 1 100%; }
.anime-related a { display: block; margin: 5px 0; }
.bookmark-actions-container { margin: 20px 0; }
.bookmark-actions-title { font-weight: bold; }
.bookmark-buttons { display: flex; gap: 10px; margin-top: 10px; }
.bookmark-btn { padding: 8px 15px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer; background-color: #444c5c; color: white; }
.bookmark-btn:hover { background-color: #1a73e8; }
.bookmark-btn.following, .bookmark-btn.checked { background-color: #2e7d32; }
.break-line { margin: 20px 0; }
.main-player-container { margin: 20px 0; }
.video-player-section { background: #2d3748; padding: 15px; border-radius: 8px; }
.video-player-header { margin-bottom: 10px; }
.controls-group { display: flex; gap: 10px; }
.control-item { display: flex; align-items: center; gap: 5px; }
.video-display iframe { width: 100%; height: 400px; }
.video-title-group { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
.nav-buttons { display: flex; gap: 10px; }
.nav-button { padding: 5px 10px; background: #2563eb; color: white; border: none; border-radius: 4px; }
.episodes-section { margin-top: 10px; }
.episodes-header { display: flex; justify-content: space-between; align-items: center; }
.episodes-title { font-size: 1.1em; }
.pagination-controls { display: flex; gap: 5px; }
.episodes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 5px; }
.tabs-custom { margin: 20px 0; }
.tab__btns { display: flex; gap: 10px; margin-bottom: 10px; }
.tab__btn { padding: 10px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
.tab__panel { display: none; }
.tab__panel.active { display: block; }
.tab-custom-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
.tab-custom-table th, .tab-custom-table td { padding: 8px; border: 1px solid #4b5563; }
.custom-detail__btn { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 10px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
.custom-detail__panel { margin-top: 10px; }
.anime-tags { margin-top: 20px; }
.anime-tags span { margin-right: 10px; }
</style>
<script>
function changeAudioOption() {
    // Placeholder: Implementar l√≥gica para cambiar opciones de audio
}
function changeEpisodeOption() {
    // Placeholder: Implementar l√≥gica para cambiar episodios
}
function changeEpisodeRange() {
    // Placeholder: Implementar l√≥gica para cambiar rango de episodios
}
document.addEventListener('DOMContentLoaded', function () {
    const postId = 'post-' + (document.getElementById('postId').value || Date.now());
    const postTitle = document.getElementById('tituloPrincipal').value || 'Anime';
    const postUrl = window.location.href;
    const postThumb = document.getElementById('urlPortada').value || '';
    const btnFollow = document.getElementById('btn-follow');
    const btnFavorite = document.getElementById('btn-favorite');
    const btnPlan = document.getElementById('btn-plan');
    const keys = {
        follow: 'followedPosts',
        favorite: 'favoritePosts',
        plan: 'onPlanPosts',
    };
    function getList(key) {
        try {
            return JSON.parse(localStorage.getItem(key) || '[]');
        } catch {
            return [];
        }
    }
    function saveList(key, list) {
        localStorage.setItem(key, JSON.stringify(list));
    }
    function isInList(key) {
        const list = getList(key);
        return list.some(p => p.id === postId);
    }
    function toggleItem(key, button, activeClass) {
        let list = getList(key);
        const index = list.findIndex(p => p.id === postId);
        if (index > -1) {
            list.splice(index, 1);
            button.classList.remove(activeClass);
        } else {
            list.push({ id: postId, title: postTitle, url: postUrl, thumbnail: postThumb });
            button.classList.add(activeClass);
        }
        saveList(key, list);
    }
    if (btnFollow) {
        if (isInList(keys.follow)) btnFollow.classList.add('following');
        btnFollow.addEventListener('click', () => {
            toggleItem(keys.follow, btnFollow, 'following');
            btnFollow.textContent = btnFollow.classList.contains('following') ? '‚ùå Dejar de seguir' : 'üëÅÔ∏è Seguir';
        });
        btnFollow.textContent = btnFollow.classList.contains('following') ? '‚ùå Dejar de seguir' : 'üëÅÔ∏è Seguir';
    }
    if (btnFavorite) {
        if (isInList(keys.favorite)) btnFavorite.classList.add('checked');
        btnFavorite.addEventListener('click', () => {
            toggleItem(keys.favorite, btnFavorite, 'checked');
        });
    }
    if (btnPlan) {
        if (isInList(keys.plan)) btnPlan.classList.add('checked');
        btnPlan.addEventListener('click', () => {
            toggleItem(keys.plan, btnPlan, 'checked');
        });
    }
});
document.getElementById('copiador')?.addEventListener('click', () => {
    const enlace = document.getElementById('enlace')?.textContent;
    if (enlace) {
        navigator.clipboard.writeText(enlace).then(() => {
            alert('Contrase√±a copiada al portapapeles');
        });
    }
});
</script>
</body>
</html>
