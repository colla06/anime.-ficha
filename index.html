<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Generador de Ficha Anime Editable</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f8f8f8; }
  h1 { text-align: center; }
  form { max-width: 900px; margin: 0 auto 2rem; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 8px #ccc;}
  label { display: block; margin-top: 12px; font-weight: bold; }
  input[type=text], select, textarea { width: 100%; padding: 6px; margin-top: 4px; box-sizing: border-box; }
  select[multiple] { height: 100px; }
  .small-input { max-width: 150px; }
  button { margin-top: 20px; padding: 10px 16px; font-size: 16px; cursor: pointer; background: #0066cc; color: white; border: none; border-radius: 4px; }
  button:hover { background: #004999; }
  #htmlOutput { white-space: pre-wrap; background: #222; color: #eee; padding: 10px; border-radius: 6px; overflow-x: auto; max-height: 500px; }
  .preview-container { max-width: 900px; margin: 0 auto; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 8px #ccc; }
  .note { font-size: 0.9rem; color: #555; margin-top: -10px; }
</style>
</head>
<body>

<h1>Generador de Ficha Anime Editable</h1>

<form id="animeForm">
  <label for="searchTitle">Buscar título en AniList</label>
  <input type="text" id="searchTitle" placeholder="Ejemplo: Fullmetal Alchemist" />
  <button type="button" onclick="searchAnime()">Buscar y completar</button>
  <p class="note">Esto buscará título, imagen, estudio, sinopsis y enlaces de AniList y MyAnimeList automáticamente</p>
</form>

<form id="animeFormMain">
  <!-- Aquí va TODO tu formulario original -->
</form>

<pre id="htmlOutput"></pre>
<div class="preview-container" id="preview"></div>

<script>
async function searchAnime() {
  const title = document.getElementById('searchTitle').value.trim();
  if (!title) return alert('Introduce un título');

  const query = `
    query ($search: String) {
      Media(search: $search, type: ANIME) {
        title {
          romaji
          native
        }
        coverImage {
          large
        }
        studios { nodes { name } }
        siteUrl
        description(asHtml: false)
        idMal
      }
    }
  `;

  const variables = { search: title };
  const res = await fetch('https://graphql.anilist.co', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
    body: JSON.stringify({ query, variables })
  });

  const data = await res.json();
  const anime = data.data.Media;
  if (!anime) return alert('No se encontró el anime');

  document.getElementById('animeTitleMain').value = anime.title.romaji || '';
  document.getElementById('animeTitleAlt').value = anime.title.native || '';
  document.getElementById('coverUrl').value = anime.coverImage.large || '';
  document.getElementById('studios').value = anime.studios.nodes.map(s => s.name).join(', ');
  document.getElementById('animeListUrl').value = anime.siteUrl || '';
  document.getElementById('myAnimeListUrl').value = anime.idMal ? `https://myanimelist.net/anime/${anime.idMal}` : '';
  document.getElementById('synopsis').value = await translateToSpanish(anime.description);
}

async function translateToSpanish(text) {
  const res = await fetch('https://libretranslate.de/translate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ q: text, source: 'en', target: 'es', format: 'text' })
  });
  const json = await res.json();
  return json.translatedText || text;
}
</script>

</body>
</html>
