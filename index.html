<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generador de Ficha Anime Editable con API</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f8f8; }
    h1 { text-align: center; }
    form { max-width: 900px; margin: 0 auto 2rem; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 8px #ccc; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    input[type=text], select, textarea { width: 100%; padding: 6px; margin-top: 4px; box-sizing: border-box; }
    select[multiple] { height: 100px; }
    .small-input { max-width: 150px; }
    button { margin-top: 20px; padding: 10px 16px; font-size: 16px; cursor: pointer; background: #0066cc; color: white; border: none; border-radius: 4px; }
    button:hover { background: #004999; }
    #htmlOutput { white-space: pre-wrap; background: #222; color: #eee; padding: 10px; border-radius: 6px; overflow-x: auto; max-height: 500px; }
    .preview-container { max-width: 900px; margin: 0 auto; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 8px #ccc; }
    .note { font-size: 0.9rem; color: #555; margin-top: -10px; }
    .search-container { display: flex; gap: 10px; align-items: center; }
    #searchStatus { color: #555; margin-top: 10px; }
  </style>
</head>
<body>

<h1>Generador de Ficha Anime Editable con API</h1>

<form id="animeForm">
  <!-- Campo para buscar por ID de MyAnimeList -->
  <label for="animeId">ID de MyAnimeList (ej. 52215 para "Chi.: Chikyuu no Undou ni Tsuite")</label>
  <div class="search-container">
    <input type="number" id="animeId" placeholder="Ingresa el ID de MyAnimeList" />
    <button type="button" id="searchBtn">Buscar Anime</button>
  </div>
  <div id="searchStatus"></div>

  <label for="animeTitleMain">Título principal</label>
  <input type="text" id="animeTitleMain" required value="Chi.: Chikyuu no Undou ni Tsuite" />

  <label for="animeTitleAlt">Título alternativo</label>
  <input type="text" id="animeTitleAlt" required value="チ。―地球の運動について―" />

  <label for="coverUrl">URL de la portada (imagen)</label>
  <input type="text" id="coverUrl" required value="https://i.ibb.co/s9z7pf1/Chi-Chikyuu-no-Undou-ni-Tsuite.webp" />

  <label for="studios">Estudio(s)</label>
  <input type="text" id="studios" required value="Madhouse" />

  <label for="myAnimeListUrl">URL de MyAnimeList</label>
  <input type="text" id="myAnimeListUrl" value="https://myanimelist.net/anime/52215/Chi__Chikyuu_no_Undou_ni_Tsuite" />

  <label for="animeListUrl">URL de AniList</label>
  <input type="text" id="animeListUrl" value="https://anilist.co/anime/151514/Chi-Chikyuu-no-Undou-ni-Tsuite/" />

  <label for="synopsis">Sinopsis</label>
  <textarea id="synopsis" rows="5" required>Polonia del siglo XV, una época en la que las ideas heréticas conducían a quemar en la hoguera a quienes poseían esa mentalidad. Rafał, un niño prodigio, debía especializarse en teología en la universidad, la materia más importante en aquella época. Sin embargo, un día conoce a un hombre misterioso y comienza a investigar una posible "verdad" entre las ideas heréticas.</textarea>

  <label for="estado">Estado</label>
  <select id="estado" required>
    <option value="Finalizado" selected>Finalizado</option>
    <option value="En emisión">En emisión</option>
  </select>

  <label for="duracion">Duración</label>
  <input type="text" id="duracion" required value="24min" />

  <label for="temporadaEstacion">Temporada (estación)</label>
  <select id="temporadaEstacion" required>
    <option value="Invierno">Invierno</option>
    <option value="Primavera">Primavera</option>
    <option value="Verano">Verano</option>
    <option value="Otoño" selected>Otoño</option>
  </select>

  <label for="temporadaAnio">Temporada (año)</label>
  <input type="number" id="temporadaAnio" required min="2000" max="2100" value="2024" />

  <label for="tipo">Tipo</label>
  <select id="tipo" required>
    <option value="WEBrip" selected>WEBrip</option>
    <option value="BD">BD</option>
  </select>

  <label for="episodios">Episodios (ej. 06/25)</label>
  <input type="text" id="episodios" required value="06/25" />

  <label><strong>Datos 720p HDL</strong></label>

  <label for="fansub720">Fansub</label>
  <input type="text" id="fansub720" value="Ninguno (Subs de NF)[Edit NatsuZangetsu]" />

  <label for="subtitulos720">Subtítulos (Español España o Latino)</label>
  <input type="text" id="subtitulos720" value="Español Neutro" />

  <label for="idioma720">Idioma (Audio) (Selecciona múltiples con Ctrl o Cmd)</label>
  <select id="idioma720" multiple size="3">
    <option value="Japonés" selected>Japonés</option>
    <option value="Latino">Latino</option>
    <option value="Castellano">Castellano</option>
  </select>

  <label for="encoder720">Encoder</label>
  <input type="text" id="encoder720" value="NatsuZangetsu27" />

  <label for="formato720">Formato (siempre MP4 (x264))</label>
  <input type="text" id="formato720" readonly value="MP4 (x264)" />

  <label for="resolucion720">Resolución (siempre 1280x720)</label>
  <input type="text" id="resolucion720" readonly value="1280x720" />

  <label for="comprimido720">Comprimido</label>
  <select id="comprimido720">
    <option value="Sí" selected>Sí</option>
    <option value="No">No</option>
  </select>

  <label for="calidad720">Calidad (siempre Muy buena)</label>
  <input type="text" id="calidad720" readonly value="Muy buena" />

  <label for="tamano720">Tamaño por archivo</label>
  <input type="text" id="tamano720" value="132MB" />

  <label for="servidores720">Servidores (selección múltiple)</label>
  <select id="servidores720" multiple size="5">
    <option value="Mega" selected>Mega</option>
    <option value="MediaFire" selected>MediaFire</option>
    <option value="Google Drive">Google Drive</option>
    <option value="TeraBox">TeraBox</option>
    <option value="Index">Index</option>
  </select>

  <label for="uploader720">Uploader</label>
  <input type="text" id="uploader720" value="NatsuZangetsu27" />

  <hr />

  <label><strong>Datos 1080p FHD</strong></label>

  <label for="fansub1080">Fansub</label>
  <input type="text" id="fansub1080" value="Ninguno (Subs de NF)[Edit NatsuZangetsu]" />

  <label for="subtitulos1080">Subtítulos (Español España o Latino)</label>
  <input type="text" id="subtitulos1080" value="Español" />

  <label for="idioma1080">Idioma (Audio) (Selecciona múltiples con Ctrl o Cmd)</label>
  <select id="idioma1080" multiple size="3">
    <option value="Japonés" selected>Japonés</option>
    <option value="Latino">Latino</option>
    <option value="Castellano">Castellano</option>
  </select>

  <label for="ripper1080">Ripper</label>
  <input type="text" id="ripper1080" value="VARYG" />

  <label for="rawEncode1080">Raw/Encode</label>
  <input type="text" id="rawEncode1080" value="DKBTeam" />

  <label for="muxeo1080">Muxeo</label>
  <input type="text" id="muxeo1080" value="NatsuZangetsu27" />

  <label for="formato1080">Formato</label>
  <select id="formato1080" required>
    <option value="MKV (x265)" selected>MKV (x265)</option>
    <option value="MP4 (x264)">MP4 (x264)</option>
    <option value="MKV (x264)">MKV (x264)</option>
  </select>

  <label for="resolucion1080">Resolución (siempre 1920x1080)</label>
  <input type="text" id="resolucion1080" readonly value="1920x1080" />

  <label for="comprimido1080">Comprimido</label>
  <select id="comprimido1080">
    <option value="Sí" selected>Sí</option>
    <option value="No">No</option>
  </select>

  <label for="calidad1080">Calidad (siempre Excelente)</label>
  <input type="text" id="calidad1080" readonly value="Excelente" />

  <label for="tamano1080">Tamaño por archivo</label>
  <input type="text" id="tamano1080" value="220MB aprox~" />

  <label for="servidores1080">Servidores (selección múltiple)</label>
  <select id="servidores1080" multiple size="5">
    <option value="Mega" selected>Mega</option>
    <option value="MediaFire" selected>MediaFire</option>
    <option value="Google Drive" selected>Google Drive</option>
    <option value="TeraBox" selected>TeraBox</option>
    <option value="Index">Index</option>
  </select>

  <label for="uploader1080">Uploader</label>
  <input type="text" id="uploader1080" value="NatsuZangetsu27" />

  <button type="button" id="generateBtn">Generar Código HTML</button>
</form>

<h2>HTML generado</h2>
<pre id="htmlOutput"></pre>

<div class="preview-container" id="preview"></div>

<script>
  // Función para traducir texto de inglés a español usando LibreTranslate
  async function translateToSpanish(text) {
    if (!text) return '';
    try {
      console.log('Texto a traducir:', text);
      const response = await fetch('https://libretranslate.com/translate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          q: text,
          source: 'en',
          target: 'es',
          format: 'text'
        })
      });
      if (!response.ok) throw new Error('Error en la traducción');
      const data = await response.json();
      console.log('Texto traducido:', data.translatedText);
      return data.translatedText || text;
    } catch (error) {
      console.error('Error en la traducción:', error);
      return text;
    }
  }

  // Buscar anime por ID usando API Jikan y traducir sinopsis
  document.getElementById('searchBtn').onclick = async function() {
    const animeId = document.getElementById('animeId').value.trim();
    const statusElement = document.getElementById('searchStatus');

    if (!animeId) {
      statusElement.textContent = 'Por favor, ingresa un ID válido de MyAnimeList.';
      statusElement.style.color = 'red';
      return;
    }

    statusElement.textContent = 'Buscando datos del anime...';
    statusElement.style.color = '#555';

    try {
      const response = await fetch(`https://api.jikan.moe/v4/anime/${animeId}`);
      if (!response.ok) throw new Error('Anime no encontrado en la base de datos');
      const data = await response.json();
      const anime = data.data;

      console.log('Sinopsis original:', anime.synopsis);

      const synopsisTranslated = await translateToSpanish(anime.synopsis);

      console.log('Sinopsis traducida:', synopsisTranslated);

      document.getElementById('animeTitleMain').value = anime.title || '';
      document.getElementById('animeTitleAlt').value = anime.title_japanese || '';
      document.getElementById('coverUrl').value = anime.images.jpg.image_url || '';
      document.getElementById('studios').value = anime.studios.map(s => s.name).join(', ') || '';
      document.getElementById('myAnimeListUrl').value = anime.url || '';
      document.getElementById('synopsis').value = synopsisTranslated || '';

      const estadoMap = {
        'Finished Airing': 'Finalizado',
        'Currently Airing': 'En emisión',
        'Not yet aired': 'En emisión'
      };
      document.getElementById('estado').value = estadoMap[anime.status] || 'En emisión';

      document.getElementById('duracion').value = anime.duration ? anime.duration.replace(' per ep', '') : '';

      const temporadaMap = {
        'winter': 'Invierno',
        'spring': 'Primavera',
        'summer': 'Verano',
        'fall': 'Otoño'
      };
      document.getElementById('temporadaEstacion').value = temporadaMap[anime.season] || 'Otoño';
      document.getElementById('temporadaAnio').value = anime.year || new Date().getFullYear();

      document.getElementById('episodios').value = anime.episodes ? `01/${anime.episodes}` : '';

      statusElement.textContent = 'Datos del anime cargados y sinopsis traducida correctamente.';
      statusElement.style.color = 'green';
    } catch (error) {
      statusElement.textContent = 'Error al cargar los datos: ' + error.message;
      statusElement.style.color = 'red';
      console.error('Error en la búsqueda o traducción:', error);
    }
  };

  // Generar código HTML basado en los datos del formulario
  document.getElementById('generateBtn').onclick = function() {
    const form = document.getElementById('animeForm');

    // Función para obtener valores múltiples de <select multiple>
    function getSelectedOptions(id) {
      const select = document.getElementById(id);
      return Array.from(select.selectedOptions).map(opt => opt.value).join(', ');
    }

    const data = {
      animeTitleMain: form.animeTitleMain.value.trim(),
      animeTitleAlt: form.animeTitleAlt.value.trim(),
      coverUrl: form.coverUrl.value.trim(),
      studios: form.studios.value.trim(),
      myAnimeListUrl: form.myAnimeListUrl.value.trim(),
      animeListUrl: form.animeListUrl.value.trim(),
      synopsis: form.synopsis.value.trim(),
      estado: form.estado.value,
      duracion: form.duracion.value.trim(),
      temporadaEstacion: form.temporadaEstacion.value,
      temporadaAnio: form.temporadaAnio.value,
      tipo: form.tipo.value,
      episodios: form.episodios.value.trim(),
      fansub720: form.fansub720.value.trim(),
      subtitulos720: form.subtitulos720.value.trim(),
      idioma720: getSelectedOptions('idioma720'),
      encoder720: form.encoder720.value.trim(),
      formato720: form.formato720.value,
      resolucion720: form.resolucion720.value,
      comprimido720: form.comprimido720.value,
      calidad720: form.calidad720.value,
      tamano720: form.tamano720.value.trim(),
      servidores720: getSelectedOptions('servidores720'),
      uploader720: form.uploader720.value.trim(),
      fansub1080: form.fansub1080.value.trim(),
      subtitulos1080: form.subtitulos1080.value.trim(),
      idioma1080: getSelectedOptions('idioma1080'),
      ripper1080: form.ripper1080.value.trim(),
      rawEncode1080: form.rawEncode1080.value.trim(),
      muxeo1080: form.muxeo1080.value.trim(),
      formato1080: form.formato1080.value,
      resolucion1080: form.resolucion1080.value,
      comprimido1080: form.comprimido1080.value,
      calidad1080: form.calidad1080.value,
      tamano1080: form.tamano1080.value.trim(),
      servidores1080: getSelectedOptions('servidores1080'),
      uploader1080: form.uploader1080.value.trim()
    };

    // Código HTML generado
    const htmlCode = `
<div class="ficha-anime">
  <h2>${data.animeTitleMain}</h2>
  <h3>${data.animeTitleAlt}</h3>
  <img src="${data.coverUrl}" alt="Portada de ${data.animeTitleMain}" style="max-width:250px;" />
  <p><strong>Estudio:</strong> ${data.studios}</p>
  <p><strong>URL MAL:</strong> <a href="${data.myAnimeListUrl}" target="_blank">${data.myAnimeListUrl}</a></p>
  <p><strong>URL AniList:</strong> <a href="${data.animeListUrl}" target="_blank">${data.animeListUrl}</a></p>
  <p><strong>Sinopsis:</strong> ${data.synopsis}</p>
  <p><strong>Estado:</strong> ${data.estado}</p>
  <p><strong>Duración:</strong> ${data.duracion}</p>
  <p><strong>Temporada:</strong> ${data.temporadaEstacion} ${data.temporadaAnio}</p>
  <p><strong>Tipo:</strong> ${data.tipo}</p>
  <p><strong>Episodios:</strong> ${data.episodios}</p>

  <h4>Datos 720p HDL</h4>
  <p><strong>Fansub:</strong> ${data.fansub720}</p>
  <p><strong>Subtítulos:</strong> ${data.subtitulos720}</p>
  <p><strong>Idioma:</strong> ${data.idioma720}</p>
  <p><strong>Encoder:</strong> ${data.encoder720}</p>
  <p><strong>Formato:</strong> ${data.formato720}</p>
  <p><strong>Resolución:</strong> ${data.resolucion720}</p>
  <p><strong>Comprimido:</strong> ${data.comprimido720}</p>
  <p><strong>Calidad:</strong> ${data.calidad720}</p>
  <p><strong>Tamaño por archivo:</strong> ${data.tamano720}</p>
  <p><strong>Servidores:</strong> ${data.servidores720}</p>
  <p><strong>Uploader:</strong> ${data.uploader720}</p>

  <h4>Datos 1080p FHD</h4>
  <p><strong>Fansub:</strong> ${data.fansub1080}</p>
  <p><strong>Subtítulos:</strong> ${data.subtitulos1080}</p>
  <p><strong>Idioma:</strong> ${data.idioma1080}</p>
  <p><strong>Ripper:</strong> ${data.ripper1080}</p>
  <p><strong>Raw/Encode:</strong> ${data.rawEncode1080}</p>
  <p><strong>Muxeo:</strong> ${data.muxeo1080}</p>
  <p><strong>Formato:</strong> ${data.formato1080}</p>
  <p><strong>Resolución:</strong> ${data.resolucion1080}</p>
  <p><strong>Comprimido:</strong> ${data.comprimido1080}</p>
  <p><strong>Calidad:</strong> ${data.calidad1080}</p>
  <p><strong>Tamaño por archivo:</strong> ${data.tamano1080}</p>
  <p><strong>Servidores:</strong> ${data.servidores1080}</p>
  <p><strong>Uploader:</strong> ${data.uploader1080}</p>
</div>
`.trim();

    // Mostrar el código en el textarea
    const output = document.getElementById('htmlOutput');
    output.textContent = htmlCode;

    // Mostrar vista previa
    const preview = document.getElementById('preview');
    preview.innerHTML = htmlCode;
  };
</script>

</body>
</html>
